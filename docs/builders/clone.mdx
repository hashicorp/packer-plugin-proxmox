---
description: |
  The proxmox image Packer builder is able to create new images for use with
  Proxmox VE. The builder takes a cloud-init enabled virtual machine
  template name, runs any provisioning necessary on the image after
  launching it, then creates a virtual machine template.
page_title: Proxmox Clone - Builders
sidebar_title: proxmox-clone
nav_title: Clone
---

# Proxmox Builder (from an image)

Type: `proxmox-clone`
Artifact BuilderId: `proxmox.clone`

The `proxmox-clone` Packer builder is able to create new images for use with
[Proxmox](https://www.proxmox.com/en/proxmox-ve). The builder takes a virtual
machine template, runs any provisioning necessary on the image after launching it,
then creates a virtual machine template. This template can then be used as to
create new virtual machines within Proxmox.

Disks specified in a `proxmox-clone` builder configuration will replace disks
that are already present on the cloned VM template. If you want to reuse the disks
of the cloned VM, don't specify disks in your configuration.

The builder does _not_ manage templates. Once it creates a template, it is up
to you to use it or delete it.

## Configuration Reference

There are many configuration options available for the builder. They are
segmented below into two categories: required and optional parameters. Within
each category, the available configuration keys are alphabetized.

You may also want to take look at the general configuration references for
[VirtIO RNG device](#virtio-rng-device)
and [PCI Devices](#pci-devices)
configuration references, which can be found further down the page.

In addition to the options listed here, a
[communicator](/packer/docs/templates/legacy_json_templates/communicator) can be configured for this
builder.

If no communicator is defined, an SSH key is generated for use, and is used
in the image's Cloud-Init settings for provisioning.

### Required:

- `proxmox_url` (string) - URL to the Proxmox API, including the full path,
  so `https://<server>:<port>/api2/json` for example.
  Can also be set via the `PROXMOX_URL` environment variable.

- `username` (string) - Username when authenticating to Proxmox, including
  the realm. For example `user@pve` to use the local Proxmox realm. When using
  token authentication, the username must include the token id after an exclamation
  mark. For example, `user@pve!tokenid`.
  Can also be set via the `PROXMOX_USERNAME` environment variable.

- `password` (string) - Password for the user.
  For API tokens please use `token`.
  Can also be set via the `PROXMOX_PASSWORD` environment variable.
  Either `password` or `token` must be specifed. If both are set,
  `token` takes precedence.

- `token` (string) - Token for authenticating API calls.
  This allows the API client to work with API tokens instead of user passwords.
  Can also be set via the `PROXMOX_TOKEN` environment variable.
  Either `password` or `token` must be specifed. If both are set,
  `token` takes precedence.

- `node` (string) - Which node in the Proxmox cluster to start the virtual
  machine on during creation.

- `clone_vm` (string) - The name of the VM Packer should clone and build from.
  Either `clone_vm` or `clone_vm_id` must be specifed.

- `clone_vm_id` (int) - The ID of the VM Packer should clone and build from.
  Proxmox VMIDs are limited to the range 100-999999999.
  Either `clone_vm` or `clone_vm_id` must be specifed.

### Optional:

- `insecure_skip_tls_verify` (bool) - Skip validating the certificate.

- `task_timeout` (duration string | ex: "10m") - The timeout for
  Promox API operations, e.g. clones. Defaults to 1 minute.

- `pool` (string) - Name of resource pool to create virtual machine in.

- `vm_name` (string) - Name of the virtual machine during creation. If not
  given, a random uuid will be used.

- `vm_id` (int) - The ID used to reference the virtual machine. This will
  also be the ID of the final template. Proxmox VMIDs are unique cluster-wide
  and are limited to the range 100-999999999.
  If not given, the next free ID on the cluster will be used.

- `memory` (int) - How much memory (in megabytes) to give the virtual
  machine. If `ballooning_minimum` is also set, `memory` defines the maximum amount
  of memory the VM will be able to use.
  Defaults to `512`.

- `ballooning_minimum` (int) - Setting this option enables KVM memory ballooning and
  defines the minimum amount of memory (in megabytes) the VM will have.
  Defaults to `0` (memory ballooning disabled).

- `cores` (int) - How many CPU cores to give the virtual machine. Defaults
  to `1`.

- `sockets` (int) - How many CPU sockets to give the virtual machine.
  Defaults to `1`

- `cpu_type` (string) - The CPU type to emulate. See the Proxmox API
  documentation for the complete list of accepted values. For best
  performance, set this to `host`. Defaults to `kvm64`.

- `numa` (bool) - If true, support for non-uniform memory access (NUMA)
  is enabled. Defaults to `false`.

- `os` (string) - The operating system. Can be `wxp`, `w2k`, `w2k3`, `w2k8`,
  `wvista`, `win7`, `win8`, `win10`, `l24` (Linux 2.4), `l26` (Linux 2.6+),
  `solaris` or `other`. Defaults to `other`.

### VGA Config

@include 'builder/proxmox/common/vgaConfig.mdx'

#### Optional:

@include 'builder/proxmox/common/vgaConfig-not-required.mdx'

### Network Adapters

@include 'builder/proxmox/common/NICConfig.mdx'

#### Optional:

@include 'builder/proxmox/common/NICConfig-not-required.mdx'

- `serials` ([]string) - A list (max 4 elements) of serial ports attached to
the virtual machine. It may pass through a host serial device `/dev/ttyS0`
or create unix socket on the host `socket`. Each element can be `socket`
or responding to pattern `/dev/.+`. Example:

  ```json
  [
    "socket",
    "/dev/ttyS1"
  ]
  ```

### Disks

@include 'builder/proxmox/common/diskConfig.mdx'

#### Optional:

@include 'builder/proxmox/common/diskConfig-not-required.mdx'

- `template_name` (string) - Name of the template. Defaults to the generated
  name used during creation.

- `template_description` (string) - Description of the template, visible in
  the Proxmox interface.

- `onboot` (boolean) - Specifies whether a VM will be started during system
  bootup. Defaults to `false`.

- `qemu_agent` (boolean) - Enables QEMU Agent option for this VM. When enabled,
  then `qemu-guest-agent` must be installed on the guest. When disabled, then
  `ssh_host` should be used. Defaults to `true`.

- `disable_kvm` (boolean) - Disables KVM hardware virtualization. Defaults to `false`.

- `scsi_controller` (string) - The SCSI controller model to emulate. Can be `lsi`,
  `lsi53c810`, `virtio-scsi-pci`, `virtio-scsi-single`, `megasas`, or `pvscsi`.
  Defaults to `lsi`.

- `cloud_init` (bool) - If true, add an empty Cloud-Init CDROM drive after the virtual
  machine has been converted to a template. Defaults to `false`.

- `cloud_init_storage_pool` (string) - Name of the Proxmox storage pool
  to store the Cloud-Init CDROM on. If not given, the storage pool of the boot device will be used.

- `nameserver` (string) - Set nameserver IP address(es) via Cloud-Init.
  If not given, the same setting as on the host is used.

- `searchdomain` (string) - Set the DNS searchdomain via Cloud-Init.
  If not given, the same setting as on the host is used.

- `ipconfig` (array of objects) - Set IP address and gateway via Cloud-Init.
  If you have configured more than one network interface, make sure to match the order of
  `network_adapters` and `ipconfig`.

  Usage example (JSON):

  ```json
  [
    {
      "ip": "192.168.1.55/24",
      "gateway": "192.168.1.1",
      "ip6": "fda8:a260:6eda:20::4da/128",
      "gateway6": "fda8:a260:6eda:20::1"
    }
  ]
  ```

  - `ip` (string) - Either an IPv4 address (CIDR notation) or `dhcp`.

  - `gateway` (string) - IPv4 gateway.

  - `ip6` (string) - Can be an IPv6 address (CIDR notation), `auto` (enables SLAAC), or `dhcp`.

  - `gateway6` (string) - IPv6 gateway.

### Additional ISO Files

@include 'builder/proxmox/common/additionalISOsConfig.mdx'
@include 'packer-plugin-sdk/multistep/commonsteps/ISOConfig.mdx'

#### Required

@include 'packer-plugin-sdk/multistep/commonsteps/ISOConfig-required.mdx'

#### Optional

@include 'packer-plugin-sdk/multistep/commonsteps/ISOConfig-not-required.mdx'
@include 'builder/proxmox/common/additionalISOsConfig-not-required.mdx'

- `http_interface` - (string) - Name of the network interface that Packer gets
  `HTTPIP` from. Defaults to the first non loopback interface.

- `vm_interface` - (string) - Name of the network interface that Packer gets
  the VMs IP from. Defaults to the first non loopback interface.


- `full_clone` (bool) - Whether to run a full or shallow clone from the base clone_vm. Defaults to `true`.

- `boot` - (string) - Override default boot order. Format example `order=virtio0;ide2;net0`.
  Prior to Proxmox 6.2-15 the format was `cdn` (c:CDROM -> d:Disk -> n:Network)

- `bios` - (string) - Set the machine bios. This can be set to ovmf or seabios. The default value is seabios.

### EFI Config

@include 'builder/proxmox/common/efiConfig.mdx'

#### Optional:

@include 'builder/proxmox/common/efiConfig-not-required.mdx'

- `efidisk` - (string) - This option is deprecated, please use `efi_config` instead.

- `machine` - (string) - Set the machine type. Supported values are 'pc' or 'q35'.

### VirtIO RNG device

@include 'builder/proxmox/common/rng0Config.mdx'

#### Required:

@include 'builder/proxmox/common/rng0Config-required.mdx'

#### Optional:

@include 'builder/proxmox/common/rng0Config-not-required.mdx'

### PCI devices

@include 'builder/proxmox/common/pciDeviceConfig.mdx'

#### Optional:

@include 'builder/proxmox/common/pciDeviceConfig-not-required.mdx'

## Example: Cloud-Init enabled Debian

Here is a basic example creating a Debian 10 server image. This assumes
that there exists a Cloud-Init enabled image on the Proxmox server named
`debian-10-4`.

<Tabs>
<Tab heading="HCL2">

```hcl
variable "proxmox_password" {
  type    = string
  default = "supersecret"
}

variable "proxmox_username" {
  type    = string
  default = "apiuser@pve"
}

source "proxmox-clone" "debian" {
  clone_vm                 = "debian-10-4"
  cores                    = 1
  insecure_skip_tls_verify = true
  memory                   = 2048
  network_adapters {
    bridge = "vmbr0"
    model  = "virtio"
  }
  node                 = "pve"
  os                   = "l26"
  password             = "${var.proxmox_password}"
  pool                 = "api-users"
  proxmox_url          = "https://my-proxmox.my-domain:8006/api2/json"
  sockets              = 1
  ssh_username         = "root"
  template_description = "image made from cloud-init image"
  template_name        = "debian-scaffolding"
  username             = "${var.proxmox_username}"
}

build {
  sources = ["source.proxmox-clone.debian"]
}
```

</Tab>
<Tab heading="JSON">

```json
{
  "variables": {
    "proxmox_username": "apiuser@pve",
    "proxmox_password": "supersecret"
  },
  "builders": [
    {
      "type": "proxmox-clone",
      "proxmox_url": "https://my-proxmox.my-domain:8006/api2/json",
      "username": "{{user `proxmox_username`}}",
      "password": "{{user `proxmox_password`}}",
      "ssh_username": "root",
      "node": "pve",
      "insecure_skip_tls_verify": true,
      "clone_vm": "debian-10-4",
      "template_name": "debian-scaffolding",
      "template_description": "image made from cloud-init image",
      "pool": "api-users",
      "os": "l26",
      "cores": 1,
      "sockets": 1,
      "memory": 2048,
      "network_adapters": [
        {
          "model": "virtio",
          "bridge": "vmbr0"
        }
      ]
    }
  ]
}
```

</Tab>
</Tabs>
